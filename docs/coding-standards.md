# Стандарты кодирования и лучшие практики

Данный документ содержит правила и рекомендации по разработке микросервисов TaskForge для обеспечения качества кода, поддерживаемости и согласованности между командами.

## Навигация по разделам

- [OpenAPI контракты](#openapi-контракты)
- [SOLID принципы](#solid-принципы)
- [Архитектурные паттерны](#архитектурные-паттерны)
- [Стандарты кода](#стандарты-кода)
- [Тестирование](#тестирование)
- [Документация](#документация)
- [Безопасность](#безопасность)
- [Производительность](#производительность)

---

## OpenAPI контракты

### Обязательные требования
- [ ] Каждый микросервис должен иметь полный OpenAPI 3.0 спецификацию
- [ ] Все эндпойнты должны быть задокументированы с примерами запросов/ответов
- [ ] Схемы данных должны быть валидными и переиспользуемыми
- [ ] Версионирование API через заголовок `Accept: application/vnd.taskforge.v1+json`
- [ ] Swagger UI должен быть доступен по адресу `/swagger-ui.html`

### Структура спецификации
```yaml
openapi: 3.0.3
info:
  title: TaskForge Tasks Service
  version: 1.0.0
  description: Управление задачами в проектах
servers:
  - url: https://api.taskforge.com/v1
    description: Production server
paths:
  /tasks:
    get:
      summary: Получить список задач
      parameters:
        - $ref: '#/components/parameters/ProjectId'
      responses:
        '200':
          description: Список задач
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TaskListResponse'
components:
  schemas:
    Task:
      type: object
      required: [id, title, status]
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          maxLength: 255
        status:
          $ref: '#/components/schemas/TaskStatus'
```

### Лучшие практики
- [ ] Использовать единообразные имена для параметров и схем
- [ ] Добавлять валидацию через `minLength`, `maxLength`, `pattern`
- [ ] Группировать связанные эндпойнты в теги
- [ ] Включать примеры ошибок (400, 401, 403, 404, 500)
- [ ] Документировать бизнес-правила в описаниях

---

## Архитектурные паттерны

### Repository Pattern
- [ ] Абстракция доступа к данным
- [ ] Интерфейсы в Domain слое, реализации в Infrastructure
- [ ] Тестируемость через моки

### CQRS (Command Query Responsibility Segregation)
- [ ] Разделение команд (write) и запросов (read)
- [ ] Отдельные модели для чтения и записи
- [ ] Оптимизация под конкретные use case'ы

### Event Sourcing
- [ ] Хранение событий вместо состояния
- [ ] Восстановление состояния через события
- [ ] Аудит и история изменений

---

## Стандарты кода

### Именование
- [ ] Классы: PascalCase (`TaskService`, `UserRepository`)
- [ ] Методы: camelCase (`createTask`, `findUserById`)
- [ ] Константы: UPPER_SNAKE_CASE (`MAX_RETRY_COUNT`)
- [ ] Переменные: camelCase (`taskId`, `userName`)
- [ ] Пакеты: lowercase (`com.taskforge.tasks.service`)

### Структура проекта
```
src/
├── main/
│   ├── java/
│   │   └── com/taskforge/tasks/
│   │       ├── domain/          # Доменные модели и интерфейсы
│   │       ├── application/     # Use cases и сервисы
│   │       ├── infrastructure/  # Реализации репозиториев, внешние API
│   │       └── presentation/     # Controllers, DTOs
│   └── resources/
│       ├── application.yml
│       └── db/migration/        # Flyway миграции
└── test/
    ├── java/
    └── resources/
```


### Обработка ошибок
- [ ] Глобальный обработчик исключений
- [ ] Кастомные исключения для бизнес-ошибок
- [ ] Структурированные ответы об ошибках
- [ ] Логирование всех исключений

---

## Тестирование

### Пирамида тестирования
- [ ] Unit тесты (70%) - быстрые, изолированные
- [ ] Integration тесты (20%) - с БД, внешними сервисами
- [ ] E2E тесты (10%) - полные пользовательские сценарии

### Unit тесты
- [ ] Покрытие >= 80% для бизнес-логики
- [ ] Тестирование граничных случаев
- [ ] Использование моков для зависимостей
- [ ] Именование: `should_ReturnExpectedResult_When_GivenCondition`

### Integration тесты
- [ ] Testcontainers для БД и внешних сервисов
- [ ] Тестирование API контрактов
- [ ] Проверка миграций БД
- [ ] Тестирование с реальными данными

### Contract тесты
- [ ] Pact для межсервисного взаимодействия
- [ ] Валидация схем сообщений
- [ ] Тестирование совместимости версий

---

## Документация

### Код документация
- [ ] JavaDoc для публичных API
- [ ] README для каждого сервиса
- [ ] Архитектурные решения (ADR)
- [ ] Диаграммы и схемы

### API документация
- [ ] OpenAPI спецификации
- [ ] Примеры использования
- [ ] Описание ошибок и кодов ответов
- [ ] Changelog для версий API

---

## Безопасность

### Аутентификация и авторизация
- [ ] JWT токены с коротким временем жизни
- [ ] Refresh токены для обновления
- [ ] RBAC на уровне методов
- [ ] Валидация входных данных

### Защита данных
- [ ] Шифрование чувствительных данных
- [ ] Хеширование паролей (Argon2/BCrypt)
- [ ] SQL injection защита
- [ ] XSS защита

---

## Производительность

### Оптимизация запросов
- [ ] Индексы для часто используемых полей
- [ ] Пагинация для больших списков
- [ ] Кэширование часто запрашиваемых данных
- [ ] Оптимизация N+1 проблем

### Мониторинг
- [ ] Метрики времени ответа
- [ ] Мониторинг использования ресурсов
- [ ] Алерты на деградацию производительности
- [ ] Профилирование для выявления узких мест

### Масштабирование
- [ ] Stateless сервисы
- [ ] Горизонтальное масштабирование
- [ ] Load balancing
- [ ] Circuit breaker для защиты от каскадных сбоев

---




